{% extends 'base.html' %}
{% load static %}

{% block css %}
<style>
    .add-desc {
        background-color: #cccccc;
        border: none;
        padding: 5px;
        text-align: center;
        color: #ffffff;
        border-radius: 10px;
        font-size: 30px;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}

<a href="{% url 'dashbord' %}"><div class="arrow-back"></div></a>

<div class="form-cust">
    <form method="post" id="id-form-cust">
        <div class="form-content">
            <label for="id_nom">Nom</label>{{ form.nom }}
        </div>
        <div class="form-content">
            <label for="id_prenom">Prenom</label>{{ form.prenom }}
        </div>
        <div class="form-content">
            <label for="id_numero">Num√©ro</label>{{ form.numero }}
        </div>
        <div class="form-content">
            <label for="id_email">Email</label>{{ form.email }}
        </div>
        <div class="form-content">
            <label for="id_description">Description</label>
            <div id="list-input-desc">
                <input type="text" name="desc_1" maxlength="500" id="id_desc_1">
            </div>
            <div class="add-desc" id="id-add-desc">+</div>
        </div>
        {{ form.description }}
        <br><br>
        <div class="signature">
            <label>Date: </label>{{ date|date:"d-m-Y" }}   
            <br><br>
            <label>Signature Client: </label>
            <div class="bdl-signature">
                <div class="signature-cadre"  id="signatureC"></div>
                <a class="clearCanvas" id="clearCanvasC" onclick="clearSignatureC()" >Effacer</a>
            </div>         
        </div>
        <input type="text" name="signature_client_commande" maxlength="1000" id="id_signature_client_commande" style="display: none;">
        {% csrf_token %}
        <p class="button-form"><input type="submit" name="commit" value="Enregistrer"></p> 
    </form>
</div>

{% endblock %}

{% block javascripts %}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'admin/js/flashcanvas.js'%}"></script>
<script src="{% static 'admin/js/jSignature.min.js'%}"></script>
<script>

    function clearSignatureC() {
        $("#signatureC").jSignature("reset");
    }

    $(document).ready(function () {  
        let cptInput = 1; 
        const inputContainer = document.getElementById("list-input-desc");
        const input_first = document.getElementById("id_desc_1");
        let descList = [input_first];

        $("#id-add-desc").click(function() { 
            cptInput++;
            const input = document.createElement("input");
            input.type = "text";
            input.id = "id_desc_" + cptInput;
            input.name = "desc_" + cptInput;
            input.maxLength = 500;
            inputContainer.appendChild(input);
            descList.push(input);
        }); 

        var signatureC = $("#signatureC").jSignature({ 
            'color': '#000000',
            'background-color': '#ffffff',
            'decor-color': '#d0e3f0'
        });

        $("#id-form-cust").submit(function() {  
            const values = descList.map(function(input) {
                return input.value;
            });
            const valueString = values.join(";");
            $("#id_description").val(valueString);


            var signature_C_data = $('#signatureC').jSignature('getData', 'image');
            $("#id_signature_client_commande").val(signature_C_data);
        }); 

        
        $("#id_description").hide();
    });
</script>

{% endblock %}